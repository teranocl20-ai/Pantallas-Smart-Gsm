<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMART GSM - Catálogo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="stock.js"></script>
    <style>
        :root { --logo-purple: #9333ea; --logo-green: #a3e635; --deep-purple: #0f071a; }
        body {
            background-color: var(--deep-purple);
            background-image: radial-gradient(circle at 10% 20%, rgba(147, 51, 234, 0.15), transparent 30%), linear-gradient(to bottom, rgba(15, 7, 26, 0.95), rgba(10, 10, 10, 0.98));
            background-attachment: fixed; color: white; font-family: sans-serif;
        }
        .logo-img { max-width: 250px; filter: drop-shadow(0 0 10px var(--logo-purple)); animation: float 4s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .glass-card { background: rgba(30, 20, 50, 0.5); backdrop-filter: blur(12px); border: 1px solid rgba(147, 51, 234, 0.2); transition: 0.3s; }
        .glass-card:hover { border-color: var(--logo-green); transform: translateY(-5px); }
        .bg-gradient-logo { background: linear-gradient(135deg, var(--logo-purple), #4f46e5, var(--logo-green)); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <header class="sticky top-0 z-50 bg-[#0f071a]/95 backdrop-blur-lg border-b border-white/10 p-4">
    <div class="max-w-6xl mx-auto flex flex-col items-center">
        <div class="w-full flex justify-center py-4">
            <img src="https://i.postimg.cc/Sx6sf9Sr/SV-SMart-GSM-FINAL-sf.png" 
                 class="logo-img h-24 w-auto object-contain" 
                 alt="SMART GSM">
        </div>

        <div class="w-full flex flex-col gap-4">
            <input type="text" id="searchInput" placeholder="Buscar modelo..." 
                   class="w-full bg-purple-950/30 border border-purple-800/50 rounded-2xl py-4 px-6 text-white focus:outline-none focus:border-lime-400">
            
            <div id="brandSelector" class="flex flex-wrap justify-center gap-2 pb-2">
                </div>
        </div>
        
        <div id="counter" class="w-full text-[10px] font-black text-lime-400 mt-2 uppercase italic text-center md:text-left">
            Cargando...
        </div>
    </div>
</header>

    <main class="max-w-6xl mx-auto p-4 pt-8">
        <div id="container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
    </main>

    <script>
        const WHATSAPP_NUMBER = "56945970772";
        let selectedBrand = "TODOS";
        
        // 2. Función para obtener el stock de forma segura
        function getStock() {
            return window.inventarioSmartGSM || [];
        }

        function renderBrands() {
            const stockActual = getStock();
            const brands = ["TODOS", ...new Set(stockActual.map(i => i.m))];
            document.getElementById('brandSelector').innerHTML = brands.map(b => `
                <button onclick="filterBrand('${b}')" class="px-6 py-2 rounded-xl text-[11px] font-bold transition-all whitespace-nowrap ${selectedBrand === b ? 'bg-gradient-logo text-white' : 'bg-purple-900/20 text-purple-300'}">${b}</button>
            `).join('');
        }

        function filterBrand(brand) { selectedBrand = brand; renderBrands(); renderCards(); }

        function renderCards() {
            const stockActual = getStock();
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = stockActual.filter(i => (selectedBrand === "TODOS" || i.m === selectedBrand) && (i.mod.toLowerCase().includes(query) || i.m.toLowerCase().includes(query)));
            
            document.getElementById('counter').textContent = `${filtered.length} REPUESTOS DISPONIBLES`;
            
            if (filtered.length === 0 && stockActual.length === 0) {
                document.getElementById('container').innerHTML = `<p class="col-span-full text-center text-purple-300 opacity-50">No se encontraron datos en stock.js</p>`;
                return;
            }

            document.getElementById('container').innerHTML = filtered.map(i => {
                const isOut = i.s === "AGOTADA";
                return `
                    <div class="glass-card rounded-2xl p-5 flex flex-col justify-between ${isOut ? 'opacity-40 grayscale pointer-events-none' : ''}">
                        <div>
                            <div class="flex justify-between items-start mb-4">
                                <span class="text-[9px] bg-purple-950 text-purple-300 px-2 py-1 rounded border border-purple-500/30 font-bold">${i.m}</span>
                                <span class="${isOut ? 'text-red-500' : 'text-lime-400'} text-[9px] font-bold uppercase">${isOut ? 'Agotado' : 'Disponible'}</span>
                            </div>
                            <h2 class="text-xl font-bold text-white">${i.mod}</h2>
                            <p class="text-purple-200/50 text-[11px] font-bold italic uppercase">${i.c}</p>
                        </div>
                        <div class="flex items-end justify-between mt-8">
                            <div>
                                <span class="text-[9px] text-purple-300/40 font-bold block">Precio</span>
                                <span class="text-2xl font-black text-white">$${i.p}</span>
                            </div>
                            <a href="https://wa.me/${WHATSAPP_NUMBER}?text=Hola! Consulto stock: Pantalla ${i.m} ${i.mod}" 
   target="_blank" 
   class="w-12 h-12 bg-emerald-600 rounded-2xl flex items-center justify-center text-white">
   <i class="fab fa-whatsapp text-2xl"></i>
</a>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 3. Aseguramos que cargue apenas abra
        window.onload = () => { 
            renderBrands(); 
            renderCards(); 
            document.getElementById('searchInput').oninput = renderCards; 
        };
    </script>
</body>

</html>
